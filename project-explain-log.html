<!-- ===================================================================== -->
<!-- File: project-explain-log.html ------------------------------------- -->
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Explain This Log | Khush Pindoria</title>

  <!-- Tailwind & Font -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />

  <!-- Shared theme tokens (identical to other pages) -->
  <style>
    :root {
      --bg-color:  #FAFAFA;
      --card-bg:   #FFFFFF;
      --text-color:#1A1A1A;
      --accent-color:#1565C0;
      --input-border:#B0BEC5;
    }
    .dark {
      --bg-color:  #0A0A0A;
      --card-bg:   #212121;
      --text-color:#F5F5F5;
      --accent-color:#64B5F6;
      --input-border:#546E7A;
    }
    body{background:var(--bg-color);color:var(--text-color);font-family:'Roboto',sans-serif;}

    /* Card shell (matches slider page) */
    .card{background:var(--card-bg);border-radius:8px;box-shadow:0 10px 20px rgba(0,0,0,.15);}

    /* Small helper for streaming cursor */
    .type-here::after{
      content:"‚ñç";animation:blink 1s steps(1) infinite;
    }
    @keyframes blink{50%{opacity:0}}
  </style>
</head>
<body>

  <!-- Dark-mode toggle (same markup & behaviour) -->
  <div class="fixed top-4 right-4 z-50">
    <button id="darkModeToggle"
            class="btn bg-gradient-to-r from-blue-600 to-blue-700 dark:bg-blue-800 text-white p-2 rounded-full shadow-md">
      ‚òÄ
    </button>
  </div>

  <!-- Main content -->
  <main class="min-h-screen flex flex-col items-center justify-center px-4">
    <h1 class="text-3xl md:text-5xl font-bold mb-6 text-center">Explain&nbsp;This&nbsp;Log</h1>
    <p class="text-secondary text-center mb-8">
      Paste a log line to receive a human-readable summary and mitigation tips.
    </p>

    <!-- Card wrapper to mirror other demos -->
    <div class="card w-full max-w-2xl p-6 flex flex-col gap-4">

      <!-- Log input -->
      <textarea id="logInput"
                class="w-full h-40 rounded-lg border p-4 bg-white dark:bg-zinc-800 dark:text-white"
                placeholder="e.g., Jun 3 09:14:22 host sshd[12345]: Failed password for invalid user root from 12.34.56.78 port 4242 ssh2">
      </textarea>

      <!-- Go button -->
      <button id="goBtn"
              class="btn self-center px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg
                     hover:from-blue-700 hover:to-blue-800">
        Explain&nbsp;Log
      </button>

      <!-- Streaming output -->
      <pre id="output"
           class="w-full h-48 overflow-x-auto whitespace-pre-wrap rounded-lg border p-4 bg-zinc-100
                  dark:bg-zinc-800 dark:text-white"></pre>
    </div>

    <!-- Back link (matches slider page style) -->
    <a href="index.html"
       class="mt-10 btn bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-2 rounded-lg">
      ‚Üê Back to site
    </a>
  </main>

  <script>
    /* Dark-mode toggle (identical JS) */
    const dm = document.getElementById('darkModeToggle');
    dm.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      dm.textContent = document.documentElement.classList.contains('dark') ? '‚òÄ' : 'üåô';
    });

    /* Worker endpoint & simple password cache */
    const endpoint = "https://explainlog.khush23.workers.dev";
    async function getPassword(){
      let pw = sessionStorage.getItem("explainlog_pw");
      if(!pw){ pw = prompt("Password"); if(pw) sessionStorage.setItem("explainlog_pw", pw); }
      return pw||"";
    }

    /* Handle click */
    document.getElementById('goBtn').addEventListener('click', async () => {
      const log = document.getElementById('logInput').value.trim();
      const out = document.getElementById('output');
      if(!log){ alert("Please paste a log line first."); return; }

      out.textContent = "‚è≥ Working‚Ä¶";
      const pw = await getPassword();

      try{
        const res = await fetch(endpoint, {
          method:"POST",
          headers:{ "Content-Type":"application/json", "X-Auth":pw },
          body:JSON.stringify({ log })
        });
        if(res.status===401) throw new Error("Incorrect password");
        if(res.status===429) throw new Error("Rate limit hit ‚Äî try later");
        if(!res.ok) throw new Error(`Error: ${res.status}`);

        const answer = await res.text();       // Worker returns plain text
        out.textContent = answer;
        out.scrollTop  = out.scrollHeight;
      }catch(err){ alert(err.message); 
        out.textContent = "";}
    });
  </script>
</body>
</html>
